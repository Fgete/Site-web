<!DOCTYPE html>
<html lang="fr">
	<head>
		<title>Mastermind</title>
		<meta charset="utf-8"/>
		<link rel="shortcut icon" type="image/x-icon" href="../images/profil.jpg"/>
		<link rel="stylesheet" type="text/css" href="../../css/mastermind.css">
	</head>

	<body onload="SetupGame()">
		<header>
			<h1 class="titre">Mastermind</h1>
		</header>
		<fieldset>
			<div id="global">
				<script>
					// HIDDEN CODE PANEL
					// Var
					var numberTry = 12;
					var numberSlot = 4;

					document.write("<div id='code' class='row'>");
					// Create slots
					for (var i = 0; i < numberSlot; i++)
						document.write("<div id='code" + i + "' class='code slot'></div>");

					document.write("<div id='gameState' class='slotInfo'></div>");
					document.write("</div>");

					// TRY PANEL
					// Create row
					for (var i = 0; i < numberTry; i++){
						// OPEN ROW
						document.write("<div id='row" + i + "' class='row'>");

							// OPEN SLOT
							for (var j = 0; j < numberSlot; j++)
								document.write("<div id='slot" + i + j + "' class='slot'></div>");
							// CLOSE SLOT

							// OPEN INFO
							document.write("<div id='info" + i + "' class='slotInfo'>");

								// OPEN DOTS
								for (var j = 0; j < numberSlot; j++)
									document.write("<div id='dot" + i + j + "' class='dot'></div>");
								// CLOSE DOTS

							document.write("</div>");
							// CLOSE INFO

						document.write("</div>");
						// CLOSE ROW
					}

					// INPUT PANEL
					document.write("<div id='input' class='row'>");
					// Create slots
					for (var i = 0; i < numberSlot; i++)
						document.write("<div id='input" + i + "' class='input slot' onclick='InputColor(input" + i + ")'></div>");

					document.write("<div id='okButton' class='slotInfo' onclick='Check()'>OK</div>");
					document.write("</div>");
				</script>
			</div>
			<div id="regles" onclick="NextRegle()">
				<div id="r0" class="regle">
					<p>Bienvenue dans le jeu Mastermind !</p>
					<p>[click]</p>
				</div>
				<div id="r1" class="regle">
					<p>Vous devez découvrir quelle combinaison de couleurs se cache ici ==></p>
				</div>
				<div id="r2" class="regle">
					<p>Pour cela, vous devez constituer différentes combinaisons ici... ==></p>
				</div>
				<div id="r3" class="regle">
					<p><== ...puis les valider en cliquant là.</p>
				</div>
				<div id="r4" class="regle">
					<p><== Dans ces emplacements apparaîtront des pions noirs ou blancs.</p>
				</div>
				<div id="r5" class="regle">
					<p>Ces pions vous donnent des indices :</p>
					<div id="rInfo" class="rSlotInfo">
						<div id="rSlot1" class='rSlot'></div>
						<div id="rSlot2" class='rSlot'></div>
						<div id="rSlot3" class='rSlot'></div>
						<div id="rSlot4" class='rSlot'></div>
					</div>
					<p>NOIR = Bonne couleur</p>
					<p>BLANC = Bonne couleur au bon endroit</p>
				</div>
				<div id="r6" class="regle" onclick="Go()">
					<p>PRET A JOUER ?</p>
				</div>
			</div>

			<script>
				var nRegle = 0;
				// Passe à la règle suivante
				function NextRegle(){
					if (nRegle < 5){
						document.getElementById("r" + nRegle).style.display = "none";
						nRegle++;
						document.getElementById("r" + nRegle).style.display = "flex";
					}else
						document.getElementById("r6").style.display = "flex";
				}

				function Go(){
					document.getElementById("regles").style.display = "none";
				}
			</script>

			<script>
				// Var
				var colorList = ["rgb(255, 255, 0)", "rgb(255, 0, 255)", "rgb(0, 255, 255)", "rgb(255, 0, 0)", "rgb(0, 255, 0)", "rgb(0, 0, 255)"];
				var colorCode = [];
				var round = 0;

				// Input color
				function InputColor(obj){
					// Get obj
					var input = document.getElementById(obj.id);

					// Next color
					if (colorList.indexOf(input.style.backgroundColor) != colorList.length - 1)
						input.style.backgroundColor = colorList[colorList.indexOf(input.style.backgroundColor) + 1];
					else
						input.style.backgroundColor = colorList[0];
				}

				// Setup inputs
				function SetupInput(){
					for (var i = 0; i < numberSlot; i++){
						document.getElementById("input" + i).style.backgroundColor = colorList[0];
					}
				}

				function Check(){
					var nDot = 0;
					var valid = 0;
					// Place combinaison proposition
					round++;

					// Put color proposition
					for (var i = 0; i < numberSlot; i++)
						document.getElementById("slot" + (numberTry - round) + i).style.backgroundColor = document.getElementById("input" + i).style.backgroundColor;

					// Reset inputs
					SetupInput();

					// Checking matches
					for (var i = 0; i < numberSlot; i++) {
						// Check color AND position
						if (document.getElementById("slot" + (numberTry - round) + i).style.backgroundColor == colorCode[i]){
							// WHITE DOT
							document.getElementById("dot" + (numberTry - round) + nDot).style.backgroundColor = "white";
							valid++;
							console.log(valid);
						}
						// Check color only
						else if (colorCode.includes(document.getElementById("slot" + (numberTry - round) + i).style.backgroundColor)){
							// BLACK DOT
							document.getElementById("dot" + (numberTry - round) + nDot).style.backgroundColor = "black";
						}

						// next dot
						nDot++;
					}
					// n round
					console.log("n round : " + round);

					WinCheck(round, valid);
				}

				function WinCheck(nR, nV){
					if (nR < 13 && nV == 4){
						alert("BRAVO !!! Vous avez gagné !");
						Reveal();
					}
					if (nR == 12 && nV != 4){
						alert("Vous avez perdu...");
						Reveal();
					}
				}

				function SetupGame(){
					// Setup inputs
					SetupInput();

					// Setup colorCode
					for (var i = 0; i < numberSlot; i++)
						colorCode[i] = colorList[Math.floor(Math.random() * 6)];

					// Setup round
					round = 0;
				}

				function Reveal(){
					for (var i = 0; i < numberSlot; i++)
						document.getElementById("code" + i).style.backgroundColor = colorCode[i];
				}
			</script>
		</fieldset>
		<footer>
			<a href="../../index.html" id="retour">RETOUR</a>
		</footer>
	</body>
</html>